<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>안드로이드 파일 쓰기</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- awesome font   -->
    <script src="https://kit.fontawesome.com/09fc514f86.js" crossorigin="anonymous"></script>
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->

    <!-- This tag outputs SEO meta+structured data and other important settings -->
        <meta name="google-site-verification" content="GCZr_aYYwDvGhBvJNkNJft6FY0cIWqpS9Zce3sPH784"/>

    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>안드로이드 파일 쓰기 | 몬드의 개발로그</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="안드로이드 파일 쓰기" />
<meta name="author" content="jisoo Yang" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="안드로이드 저장소의 형태를 구분하고, 실제 파일을 생성하고 사용하는 방법에 대해 정리하였습니다." />
<meta property="og:description" content="안드로이드 저장소의 형태를 구분하고, 실제 파일을 생성하고 사용하는 방법에 대해 정리하였습니다." />
<link rel="canonical" href="https://mond-al.github.io/file-write" />
<meta property="og:url" content="https://mond-al.github.io/file-write" />
<meta property="og:site_name" content="몬드의 개발로그" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-02T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="안드로이드 파일 쓰기" />
<script type="application/ld+json">
{"url":"https://mond-al.github.io/file-write","author":{"@type":"Person","name":"jisoo Yang"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://mond-al.github.io/assets/images/logo/normal_icon.png"},"name":"jisoo Yang"},"headline":"안드로이드 파일 쓰기","dateModified":"2021-02-02T00:00:00+09:00","datePublished":"2021-02-02T00:00:00+09:00","description":"안드로이드 저장소의 형태를 구분하고, 실제 파일을 생성하고 사용하는 방법에 대해 정리하였습니다.","mainEntityOfPage":{"@type":"WebPage","@id":"https://mond-al.github.io/file-write"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta property="og:image" content="https://mond-al.github.io/assets/images/cover/common_android.jpg"/>
    <meta property="og:image:width" content="800"/> <meta property="og:image:height" content="540"/> 
    <meta property="article:publisher" content="https://www.facebook.com/jisoo.yang.56"/>
    <meta name="referrer" content="no-referrer-when-downgrade"/>

    <link rel="shortcut icon" href="https://mond-al.github.io/assets/images/fav/favicon-96x96.png" type="image/png"/>
    <link rel="alternate" type="application/rss+xml" href="https://mond-al.github.io/rss.xml">

    



</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->
<!-- awesome font   -->
<script src="https://kit.fontawesome.com/09fc514f86.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/assets/built/syntax.css">
<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://mond-al.github.io/"><img src="/assets/images/logo/normal_icon.png" alt="몬드의 개발로그" /></a>
            
        
        
            <!--메뉴 네비바 -->
<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/android/">Android</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="#search">Search</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-fb" href="https://facebook.com/jisoo.yang.56" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-android tag-file tag-scoped-storage  ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 2 February 2021"> 2 February 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/android/'>ANDROID</a>,
                            
                        
                            
                               <a href='/tag/file/'>FILE</a>,
                            
                        
                            
                               <a href='/tag/scoped-storage/'>SCOPED STORAGE</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">안드로이드 파일 쓰기</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/cover/common_android.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>안드로이드 저장소의 형태를 구분하고, 실제 파일을 생성하고 사용하는 방법에 대해 정리하였습니다.</p>

<p><strong>코드 아래 path를 정리해두었는데 path는 제조사,기종,OS버전등에 의해 따라 달라질 수 있습니다. 대략적인 형상에 대해 정리 해두는 자료로 이해하기 바랍니다.</strong></p>

<h2 id="용어정리">용어정리</h2>

<h3 id="device-storage저장소의-구분">Device Storage(저장소)의 구분</h3>
<pre><code class="language-tree">A.Internal Storage : 내부 저장소  
B.External Storage : 외부 저장소  
   B1. Built in non-removable storage : 기본으로 제공되는 빌트인 저장소. 보통 내장메모리라고 표현.  
   B2. SDcard : 디바이스 제조사, 모델에 따라 지원 할 수도 있는 SDcard    
   B3. USB Storage : USB 단자를 통해 연결된 저장장치  
</code></pre>
<p>기본적으로 내부 메모리 영역은 사용자가 직접 접근할 수 없는 영역이라고 생각 하면 됩니다. 보통의 경우 <code class="language-plaintext highlighter-rouge">외부저장소는 B1</code>을 지칭합니다.</p>

<h3 id="external-storage-정책의-구분">External Storage 정책의 구분</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- Legacy External Storage 
   : Scoped Storage가 적용되지않은 상태. targetSdkVersion이 28이하 이거나 단말이 Android 9이하. 
- Scoped Storage
   : Scoped Storage가 적용된 상태. targetSdkVersion이 29이상이고 단말이 Android 10이상.  
     단, targetSdkVersion이 29인 경우 requestLegacyExternalStorage를 활성화 하지 않아야 함 
</code></pre></div></div>

<hr />
<h1 id="앱별-저장소app-specific-storage">앱별 저장소(App-specific storage)</h1>
<p>내부/외부 저장소에 전용 디렉터리에 앱 전용으로 사용되는 파일을 저장합니다. 다른 앱이 액세스해서는 안 되는 민감한 정보를 저장하려면 내부 저장소 내의 디렉터리를 사용합니다. 외부저장소에 저장된 파일은 사용자나 다른 앱에 의해 읽기/쓰기/삭제 가능합니다.</p>

<h2 id="1-cache-영역">1. Cache 영역</h2>

<p>별도의 권한없이 파일을 생성,삭제 가능합니다. 다른 앱이나 사용자가 접근 할 수 없습니다. 추가 디스크 공간이 필요할 때 캐시 데이터의 총합이 할당된 크기를 초과한 경우 캐시영역의 파일이 삭제됩니다. sharedUserId 기능을 사용하는 경우 공유 UID의 모든 패키지에 대해 캐시 된 데이터가 함께 추적됩니다. 앱이 삭제되면 함께 삭제됩니다 .<a href="">link</a></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 내부 저장소</span>
<span class="kd">val</span> <span class="py">cacheFile</span> <span class="p">=</span> <span class="nc">File</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">cacheDir</span><span class="p">,</span> <span class="s">"cache_file.txt"</span><span class="p">)</span>
<span class="c1">// &gt; /data/user/0/*{applicationId}*/**cache**/cache_file.txt  #A</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 외부 저장소</span>
<span class="kd">val</span> <span class="py">externalCacheFile</span> <span class="p">=</span> <span class="nc">File</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">externalCacheDir</span><span class="p">,</span> <span class="s">"ex_cache_file.txt"</span><span class="p">)</span>
<span class="c1">// &gt; /storage/emulated/0/Android/data/{applicationId}/**cache**/ex_cache_file.txt  #B1</span>
</code></pre></div></div>

<p>cache에 사용되는 데이터도</p>

<h3 id="캐시-할당-크기-및-사용중인-크기">캐시 할당 크기 및 사용중인 크기</h3>
<p>Api level 26(O)부터는 가용공간 관리를 위해 몇가지 함수들이 추가되었습니다. <a href="https://developer.android.com/reference/android/os/storage/StorageManager#getCacheQuotaBytes(java.util.UUID)">getCacheQuotaBytes</a> 는 <code class="language-plaintext highlighter-rouge">캐시에 사용할 공간으로 할당된 용량</code>을 반환하고 <a href="https://developer.android.com/reference/android/os/storage/StorageManager#getCacheSizeBytes(java.util.UUID)">getCacheSizeBytes</a> 는 <code class="language-plaintext highlighter-rouge">사용중인 캐시파일의 전체 총합</code>을 확인 할 수 있습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>StorageManager storageManager = (StorageManager) getSystemService(Context.
val quotaByte = storageManager.getCacheQuotaBytes(storageManager.getUuidForPath(getCacheDir())) // 캐시에 사용할 공간으로 할당된 용량
val cacheSize = storageManager.getCacheSizeBytes(uuidForPath) // 사용중인 캐시파일의 전체 총합
</code></pre></div></div>

<h2 id="2-file-영역">2. File 영역</h2>

<p>앱이 설치 되어있는 동안만 영속적(Persistence)으로 필요한 파일을 저장하는 영역입니다. 앱이 삭제되면 함께 삭제됩니다. 별도의 권한 없이 파일을 생성가능합니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// style #1</span>
<span class="kd">val</span> <span class="py">file1</span> <span class="p">=</span> <span class="nc">File</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">fileDir</span><span class="p">,</span> <span class="s">"file.txt"</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">outputStream</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">outputStream</span><span class="p">()</span>
<span class="c1">// &gt; /data/user/0/*{applicationId}*/**files**/file.txt  #A</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// style #2</span>
<span class="kd">val</span> <span class="py">outputStream</span> <span class="p">=</span> <span class="nf">openFileOutput</span><span class="p">(</span><span class="s">"file.txt"</span><span class="p">,</span> <span class="nc">MODE_PRIVATE</span><span class="p">)</span>
<span class="c1">// &gt; /data/user/0/*{applicationId}*/**files**/file.txt  #A</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">style #1</code>과 <code class="language-plaintext highlighter-rouge">style #2</code>의 결과로 얻어지는 FileOutputStream은 동일한 파일을 가르키고 있습니다. 하지만 개인적으로는 <code class="language-plaintext highlighter-rouge">openFileOutput</code>메서드를 사용하면 <code class="language-plaintext highlighter-rouge">FileOutputStream</code>에서 path를 얻을 수 없기 때문에 명시적으로 File 객체를 생성하여 사용하는 style #1을 주로 사용하고 있습니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">externalFile</span> <span class="p">=</span> <span class="nc">File</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="nf">getExternalFilesDir</span><span class="p">({</span><span class="nc">Environment</span> <span class="nc">Type</span><span class="p">},</span> <span class="s">"file.txt"</span><span class="p">)</span>
<span class="c1">// &gt; /storage/emulated/0/Android/data/**files**/*{Environment Type}*/file.txt #B1</span>
</code></pre></div></div>

<p>외부저장소에 앱데이터를 저장할때 사용합니다. 공유저장 장치가 에뮬레이션 된 경우에는 Scoped Storage가 적용되지 않은 상태에서는 <code class="language-plaintext highlighter-rouge">WRITE_EXTERNAL_STORAGE</code>권한만 있으면, 이 영역에 접근가능하기 때문에 보안에 취약합니다. 또한 사용자가 파일브라우져를 통해 삭제 할 수 있습니다.</p>

<h1 id="공유-저장소-shared-storage">공유 저장소 (Shared storage)</h1>
<p>미디어, 문서 및 기타 파일을 비롯하여 앱이 다른 앱과 공유하려는 파일을 저장합니다. 다른앱에서 접근을 허용해야 하기 때문에 공유 저장소는 내부저장소를 사용 할 수 없습니다.</p>

<h2 id="legacy-external-storage">Legacy External Storage</h2>
<p>Scoped Storage가 적용되지않은 상태. targetSdkVersion이 28이하 이거나 단말이 Android 9이하인 경우에는 Legacy External Storage를 사용가능 했습니다. 미디어와 파일의 구분없이 생성가능합니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">file</span> <span class="p">=</span> <span class="nc">File</span><span class="p">(</span><span class="nc">Environment</span><span class="p">.</span><span class="nf">getExternalStorageDirectory</span><span class="p">(),</span> <span class="s">"file.txt"</span><span class="p">)</span>
<span class="c1">// &gt; /storage/emulated/0/file.txt #B1</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Legacy External Storage</code>일때는 <code class="language-plaintext highlighter-rouge">WRITE_EXTERNAL_STORAGE</code>권한이 있는 경우 위와같이 외부저장소의 루트부터 대부분의 공간에 접근하고 쓰기가 가능했습니다. 그리고 필요한 경우 미디어는 ContentProvider에 등록했습니다.</p>

<blockquote>
  <p>Legacy External Storage 정책에서 공유되는 파일 작성 순서 <br />
Step 1. 쓰기 권한을 얻습니다.<br />
Step 2. 파일을 작성합니다.<br />
Step 3. 그리고 용도에 따라 명시적으로 ContentProvider에 등록합니다.</p>
</blockquote>

<h2 id="scoped-storage">Scoped Storage</h2>

<h3 id="media-유형">Media 유형</h3>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Scoped Storage</span>
<span class="kd">val</span> <span class="py">resolver</span> <span class="p">=</span> <span class="n">applicationContext</span><span class="p">.</span><span class="n">contentResolver</span>
<span class="kd">val</span> <span class="py">audioCollection</span> <span class="p">=</span> <span class="nc">MediaStore</span><span class="p">.</span><span class="nc">Audio</span><span class="p">.</span><span class="nc">Media</span><span class="p">.</span><span class="nf">getContentUri</span><span class="p">(</span>
        <span class="nc">MediaStore</span><span class="p">.</span><span class="nc">VOLUME_EXTERNAL_PRIMARY</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">newSongDetails</span> <span class="p">=</span> <span class="nc">ContentValues</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
    <span class="nf">put</span><span class="p">(</span><span class="nc">MediaStore</span><span class="p">.</span><span class="nc">Audio</span><span class="p">.</span><span class="nc">Media</span><span class="p">.</span><span class="nc">DISPLAY_NAME</span><span class="p">,</span> <span class="s">"My Song.mp3"</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">val</span> <span class="py">myFavoriteSongUri</span> <span class="p">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">audioCollection</span><span class="p">,</span> <span class="n">newSongDetails</span><span class="p">)</span>
<span class="c1">// &gt; content://media/external/audio/media/{id}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Scoped Storage</code>가 적용되면 다른앱과 공유되는 미디어 파일은 모두 MediaStore를 이용하여 생성해야 합니다.</p>

<blockquote>
  <p>개인적으로 처음에 Scoped Storage를 접했을때 <code class="language-plaintext highlighter-rouge">MediaStore를 이용하여 생성해야 합니다</code>라는 문맥때문에 혼란이 왔습니다. MediaStore 클래스가 핵심인 것은 맞지만 구현의 관점에서는 아래처럼 읽으면 문맥이 더 이해가 쉬웠습니다. <br />
ContentResolver.insert는 MediaStore API와 ContentValues 객체를 인자로 받아 Uri를 생성합니다. ContentResolver.openXXXXX 메서드를 통해 FileOutputStream이나 ParcelFileDescriptor를 얻어서 파일을 쓰도록 합니다.</p>
</blockquote>

<p>참고로 insert에서 반환하는 Uri는 Content Provider의 컨텐츠이기 때문에 <code class="language-plaintext highlighter-rouge">content://</code>로 시작합니다.</p>

<blockquote>
  <p>Scoped Storage 정책에서 공유되는 파일 작성 <br />
Step 1. ContentProvider에 파일에 대한 정보를 추가합니다. <br />
Step 2. Step 1에서 얻은 Uri를 통해 파일을 작성합니다.</p>
</blockquote>

<h3 id="file문서-유형">File(문서) 유형</h3>

<p><code class="language-plaintext highlighter-rouge">Scoped Storage</code>에서도 사용자 액션을 통해 파일을 특정 외부저장소에 저장가능합니다. 하지만, Legacy External Storage 에서 처럼 지정한 폴더에 지정한 이름으로 저장하지 않고, SAF(Storage Access Framework)를 통해 유저가 선택 할 수 있습니다. 우리는 단지 생성할 폴더,파일명 초기값만 넘겨주고 사용자가 선택하도록 합니다. onResultActivity를 통해 전달받은 uri를 통해 우리는 해당 파일을 컨트롤 할 수 있습니다.</p>

<p>아래는 간단한 예를 들기 위해 액티비티가 시작되면 사용자가 파일을 생성하고, 생성한 파일에 다운로드 받아 저장하는 아주 단순한 예제코드입니다. 가독성과 복붙만으로 동작을 보장하기 위해 의존성과 코드를 최대한으로 줄였습니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">DownloadAndSaveActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">requestCodeForCreateDocument</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">1000</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="nf">setContentView</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>
        <span class="nf">reqeustCreateDoc</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">reqeustCreateDoc</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">intent</span> <span class="p">=</span> <span class="nc">Intent</span><span class="p">(</span><span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_CREATE_DOCUMENT</span><span class="p">).</span><span class="nf">apply</span> <span class="p">{</span>
            <span class="nf">addCategory</span><span class="p">(</span><span class="nc">Intent</span><span class="p">.</span><span class="nc">CATEGORY_OPENABLE</span><span class="p">)</span>
            <span class="nf">putExtra</span><span class="p">(</span><span class="nc">Intent</span><span class="p">.</span><span class="nc">EXTRA_TITLE</span><span class="p">,</span> <span class="s">"example.pdf"</span><span class="p">)</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"application/pdf"</span>
        <span class="p">}</span>
        <span class="nf">startActivityForResult</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">requestCodeForCreateDocument</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onActivityResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">resultCode</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nc">Intent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onActivityResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span> <span class="n">resultCode</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">requestCode</span> <span class="p">==</span> <span class="n">requestCodeForCreateDocument</span> <span class="p">&amp;&amp;</span> <span class="n">resultCode</span> <span class="p">==</span> <span class="nc">Activity</span><span class="p">.</span><span class="nc">RESULT_OK</span> <span class="p">&amp;&amp;</span> <span class="n">data</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">Thread</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">inUri</span> <span class="p">=</span> <span class="nc">Uri</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="s">"http://www.africau.edu/images/default/sample.pdf"</span><span class="p">)</span>
                <span class="kd">val</span> <span class="py">outUri</span> <span class="p">=</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="nc">Uri</span>
                <span class="nf">download</span><span class="p">(</span><span class="n">inUri</span><span class="p">,</span> <span class="n">outUri</span><span class="p">)</span>
            <span class="p">}.</span><span class="nf">start</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">download</span><span class="p">(</span><span class="n">sourceUri</span><span class="p">:</span> <span class="nc">Uri</span><span class="p">,</span> <span class="n">destUri</span><span class="p">:</span> <span class="nc">Uri</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">connect</span> <span class="p">=</span> <span class="nc">URL</span><span class="p">(</span><span class="n">sourceUri</span><span class="p">.</span><span class="nf">toString</span><span class="p">()).</span><span class="nf">openConnection</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">inputStream</span> <span class="p">=</span> <span class="n">connect</span><span class="p">.</span><span class="nf">getInputStream</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">outputStream</span><span class="p">:</span> <span class="nc">FileOutputStream</span> <span class="p">=</span> <span class="n">contentResolver</span><span class="p">.</span><span class="nf">openFileDescriptor</span><span class="p">(</span><span class="n">destUri</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span><span class="o">?.</span><span class="nf">use</span> <span class="p">{</span> <span class="n">pfd</span> <span class="p">-&gt;</span>
            <span class="nc">FileOutputStream</span><span class="p">(</span><span class="n">pfd</span><span class="p">.</span><span class="n">fileDescriptor</span><span class="p">)</span>
        <span class="p">}</span> <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">()</span>
        <span class="nf">writeStream</span><span class="p">(</span><span class="n">inputStream</span><span class="p">,</span> <span class="n">outputStream</span><span class="p">)</span>
    <span class="p">}</span>


    <span class="k">private</span> <span class="k">fun</span> <span class="nf">writeStream</span><span class="p">(</span><span class="n">inputStream</span><span class="p">:</span> <span class="nc">InputStream</span><span class="p">,</span> <span class="n">outputStream</span><span class="p">:</span> <span class="nc">OutputStream</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="py">total</span> <span class="p">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">data</span> <span class="p">=</span> <span class="n">inputStream</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="p">==</span> <span class="p">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">break</span>
            <span class="p">}</span>
            <span class="n">total</span> <span class="p">+=</span> <span class="n">data</span>
            <span class="n">outputStream</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">inputStream</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="n">outputStream</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="scoped-storage-자세히-들여다-보기"><a href="scoped-storage">Scoped Storage 자세히 들여다 보기</a></h3>
<p>Scoped Storage로 전환하는 방법에 대한 내용은 따로 정리하였습니다.</p>


                </div>
            </section>

            <!-- Email search form at the bottom of the page -->
            
                <section class="search-form">
                    <h3 class="search-form-title">Search</h3>
                    <p>Get more post</p>
                    <span id="searchform" method="post" action="/search/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="search-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="keyword" />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/logo/normal.png" alt="mond" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/mond">jisoo Yang</a></h4>
                                
                                    <p>Android application developer @ Kakao</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/mond">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://mond-al.github.io/file-write';
                            this.page.identifier = '/file-write';
                            this.page.title = '안드로이드 파일 쓰기';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://mond-al.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/sky.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; 몬드의 개발로그 &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/android/">Android</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/viewpager-fragment">FragmentPagerAdapter, FragmentStatePagerAdapter (생성자 Behavior편)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/architecture-base-2">아키텍처와 클린코드 그리고 TDD (2)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/architecture-base-1">아키텍처와 클린코드 그리고 TDD (1)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/android/">
                                
                                    See all 11 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/cache-share">
                <div class="post-card-image" style="background-image: url(/assets/images/cover/common_solution.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/cache-share">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Android</span>
                            
                        
                            
                               <span class="post-card-tags">File provider</span>
                            
                        
                            
                                <span class="post-card-tags">Cache</span>
                            
                        
                    

                    <h2 class="post-card-title">File Provider Path 디렉리터 영역 매칭</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/logo/normal.png" alt="jisoo Yang" />
                        
                        <span class="post-card-author">
                            <a href="/author/mond/">jisoo Yang</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/scoped-storage">
                <div class="post-card-image" style="background-image: url(/assets/images/cover/common_android.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/scoped-storage">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Android</span>
                            
                        
                            
                               <span class="post-card-tags">Sdkversion30</span>
                            
                        
                            
                                <span class="post-card-tags">Scoped storage</span>
                            
                        
                    

                    <h2 class="post-card-title">Scoped Storage 적용하기</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/logo/normal.png" alt="jisoo Yang" />
                        
                        <span class="post-card-author">
                            <a href="/author/mond/">jisoo Yang</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://mond-al.github.io/">
            
                <img src="/assets/images/logo/black_diver_icon.png" alt="몬드의 개발로그 icon" />
            
            <span>몬드의 개발로그</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">안드로이드 파일 쓰기</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C+%ED%8C%8C%EC%9D%BC+%EC%93%B0%EA%B8%B0&amp;url=https://mond-al.github.io/file-write"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://mond-al.github.io/file-write"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://mond-al.github.io/">몬드의 개발로그</a> &copy; 2021</section>
            </div>
        </footer>

    </div>

    
    <div id="search" class="search-overlay">
        <a class="search-overlay-close" href="#"></a>
        <div class="search-overlay-content">
            
            <img class="search-overlay-logo"
                 src="/assets/images/logo/normal_icon.png"
                 alt="몬드의 개발로그" />
            
            <h1 class="search-overlay-title">Search <br>$ grep -in "{keyword}" ./log.txt</h1>
            <p class="search-overlay-description">   </p>
            <span id="searchform" method="post" action="/search/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="search-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="keyword" />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>


    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GGKL7TBGBY"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 gtag('config', 'G-GGKL7TBGBY');
</script>

    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
