<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- awesome font   -->
    <script src="https://kit.fontawesome.com/09fc514f86.js" crossorigin="anonymous"></script>
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="안드로이드 개발 로깅." />
    <link rel="shortcut icon" href="https://mond-al.github.io/assets/images/fav/favicon-96x96.png" type="image/png" />
    <link rel="canonical" href="https://mond-al.github.io/android-11-R-Storage" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage) | Developer/App/Android/mond &gt; Log</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)" />
<meta name="author" content="jisoo Yang" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Android 11(R)은 Android 6.0(M,Marshmallow)이후로 가장 큰 변화가 생긴 버전이 아닐까 합니다." />
<meta property="og:description" content="Android 11(R)은 Android 6.0(M,Marshmallow)이후로 가장 큰 변화가 생긴 버전이 아닐까 합니다." />
<link rel="canonical" href="https://mond-al.github.io/android-11-R-Storage" />
<meta property="og:url" content="https://mond-al.github.io/android-11-R-Storage" />
<meta property="og:site_name" content="Developer/App/Android/mond &gt; Log" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-01T00:00:00+09:00" />
<script type="application/ld+json">
{"url":"https://mond-al.github.io/android-11-R-Storage","headline":"안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)","datePublished":"2021-02-01T00:00:00+09:00","dateModified":"2021-02-01T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://mond-al.github.io/android-11-R-Storage"},"author":{"@type":"Person","name":"jisoo Yang"},"description":"Android 11(R)은 Android 6.0(M,Marshmallow)이후로 가장 큰 변화가 생긴 버전이 아닐까 합니다.","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Developer/App/Android/mond > Log" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)" />
    <meta property="og:description" content="Android 11(R)은 Android 6.0(M,Marshmallow)이후로 가장 큰 변화가 생긴 버전이 아닐까 합니다. Scoped Storage 적용 Android 10(Q) 발표당시 안드로이드 개발자를 공포로 몰아넣었던 Scoped Storage의 유예기간이 종료되었습니다. targetSdkVersion 29를 적용할때 Scoped Storage를 무시할 수 있도록 제공된 requestLegacyExternalStorage는 targetSdkVersion 30이 적용되면 Android 11(R) 이상 디바이스에서 무시됩니다. 대신 또 다른 일회성 유예가 추가되었습니다. preserveLegacyExternalStorage라는" />
    <meta property="og:url" content="https://mond-al.github.io/android-11-R-Storage" />
    <meta property="og:image" content="https://mond-al.github.io/assets/images/cover/common_android.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-02-01T00:00:00+09:00" />
    <meta property="article:modified_time" content="2021-02-01T00:00:00+09:00" />
    <meta property="article:tag" content="Android" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)" />
    <meta name="twitter:description" content="Android 11(R)은 Android 6.0(M,Marshmallow)이후로 가장 큰 변화가 생긴 버전이 아닐까 합니다. Scoped Storage 적용 Android 10(Q) 발표당시 안드로이드 개발자를 공포로 몰아넣었던 Scoped Storage의 유예기간이 종료되었습니다. targetSdkVersion 29를 적용할때 Scoped Storage를 무시할 수 있도록 제공된 requestLegacyExternalStorage는 targetSdkVersion 30이 적용되면 Android 11(R) 이상 디바이스에서 무시됩니다. 대신 또 다른 일회성 유예가 추가되었습니다. preserveLegacyExternalStorage라는" />
    <meta name="twitter:url" content="https://mond-al.github.io/" />
    <meta name="twitter:image" content="https://mond-al.github.io/assets/images/cover/common_android.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Developer/App/Android/mond > Log" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Android" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Developer/App/Android/mond > Log",
        "logo": "https://mond-al.github.io/"
    },
    "url": "https://mond-al.github.io/android-11-R-Storage",
    "image": {
        "@type": "ImageObject",
        "url": "https://mond-al.github.io/assets/images/cover/common_android.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://mond-al.github.io/android-11-R-Storage"
    },
    "description": "Android 11(R)은 Android 6.0(M,Marshmallow)이후로 가장 큰 변화가 생긴 버전이 아닐까 합니다. Scoped Storage 적용 Android 10(Q) 발표당시 안드로이드 개발자를 공포로 몰아넣었던 Scoped Storage의 유예기간이 종료되었습니다. targetSdkVersion 29를 적용할때 Scoped Storage를 무시할 수 있도록 제공된 requestLegacyExternalStorage는 targetSdkVersion 30이 적용되면 Android 11(R) 이상 디바이스에서 무시됩니다. 대신 또 다른 일회성 유예가 추가되었습니다. preserveLegacyExternalStorage라는"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->
<!-- awesome font   -->
<script src="https://kit.fontawesome.com/09fc514f86.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/assets/built/syntax.css">
<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://mond-al.github.io/">Developer/App/Android/mond > Log</a>
            
        
        
            <!--메뉴 네비바 -->
<ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-getting-started" role="menuitem"><a href="/tag/android/">Android</a></li>
    <li class="nav-try-ghost" role="menuitem"><a href="/tag/android/">Project</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-android tag-sdkversion30 tag-r  ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 1 February 2021"> 1 February 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/android/'>ANDROID</a>,
                            
                        
                            
                               <a href='/tag/sdkversion30/'>SDKVERSION30</a>,
                            
                        
                            
                               <a href='/tag/r/'>R</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)</h1>
            </header>

<!--            -->
<!--            <figure class="post-full-image" style="background-image: url(/assets/images/cover/common_android.jpg)">-->
<!--            </figure>-->
<!--            -->

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>Android 11(R)은 Android 6.0(M,Marshmallow)이후로 가장 큰 변화가 생긴 버전이 아닐까 합니다.</p>

<h2 id="scoped-storage-적용">Scoped Storage 적용</h2>

<p>Android 10(Q) 발표당시 안드로이드 개발자를 공포로 몰아넣었던 <code class="highlighter-rouge">Scoped Storage</code>의 유예기간이 종료되었습니다. targetSdkVersion 29를 적용할때 <code class="highlighter-rouge">Scoped Storage</code>를 무시할 수 있도록 제공된 <code class="highlighter-rouge">requestLegacyExternalStorage</code>는 targetSdkVersion 30이 적용되면 Android 11(R) 이상 디바이스에서 무시됩니다. <a href="https://developer.android.com/about/versions/11/privacy/storage?hl=ko#scoped-storage"><i class="fas fa-link"></i></a></p>

<p>대신 또 다른 일회성 유예가 추가되었습니다. <code class="highlighter-rouge">preserveLegacyExternalStorage</code>라는 플래그입니다. 이 플래그를 적용하면, <code class="highlighter-rouge">기존</code>에 사용하던 파일을 이전 할 수 있도록 예외처리됩니다. 하지만 첫 설치 또는 앱 삭제후 재설치한 경우에는 예외가 적용되지 않습니다.<a href="https://developer.android.com/training/data-storage/use-cases?hl=ko#if_your_app_targets"><i class="fas fa-link"></i></a></p>

<p>Android 9(O,Oreo)이전까지 개발자들은 <code class="highlighter-rouge">"WRITE_EXTERNAL_STORAGE"</code>권한 하나만 얻으면 뭐든 할 수 있었습니다. external storage의 루트에 자기앱이름을 따서 폴더를 만들어서 갤러리에 보여줄 파일을 다운받거나 생성하기도 하고, 그 하위나 또 다른 은밀한?곳에 <code class="highlighter-rouge">"."(dot)</code>으로 시작하는 폴더와 <code class="highlighter-rouge">".nomedia"</code>파일을 이용해서 (사용자 몰래) 파일을 생성한 경험이 있을 것 입니다. <i class="fas fa-flushed"></i></p>

<h3 id="targetsdkversion-30-을-적용하는-순간-write_external_storage는-완전히-무시됩니다">targetSdkVersion 30 을 적용하는 순간 <code class="highlighter-rouge">WRITE_EXTERNAL_STORAGE</code>는 완전히 무시됩니다.<a href="https://developer.android.com/about/versions/11/privacy/storage?hl=ko#permissions-target-11"><i class="fas fa-link"></i></a></h3>

<p>지금까지는 <code class="highlighter-rouge">WRITE_EXTERNAL_STORAGE</code>을 요청하고 승인받으면, 자동으로 <code class="highlighter-rouge">READ_EXTERNAL_STORAGE</code>를 획득 할 수 있었기 때문에 <code class="highlighter-rouge">READ_EXTERNAL_STORAGE</code>를 암묵적으로 따로 처리 하지 않은 경우를 많이 찾아 볼 수 있었습니다. 이런 경우 <code class="highlighter-rouge">onRequestPermissionsResult</code>에서 <code class="highlighter-rouge">WRITE_EXTERNAL_STORAGE</code>는 항상 <code class="highlighter-rouge">PERMISSION_DENIED</code>이기 때문에, 다시 권한을 사용자에게 요청하는 교착상태에 빠질 수 있습니다.</p>

<blockquote>
  <p>솔루션 : 앱 외부공간에 파일을 쓸 일이 있다면, 안드로이드 Q미만에서는 <code class="highlighter-rouge">WRITE_EXTERNAL_STORAGE</code>,<code class="highlighter-rouge">READ_EXTERNAL_STORAGE</code>를 사용하고 Q이상에서는 <code class="highlighter-rouge">READ_EXTERNAL_STORAGE</code>만 요청하도록 분기해야 합니다.</p>
</blockquote>

<blockquote>
  <p>솔루션 : <code class="highlighter-rouge">requestLegacyExternalStorage</code>를 적용하면 Android 10 디바이스에서 <code class="highlighter-rouge">WRITE_EXTERNAL_STORAGE</code>를 계속 사용 할 수 있지만 <code class="highlighter-rouge">maxSdkVersion="28"</code>을 명시하여 Q미만과 Q이상으로 구분하는 것이 좋을 것 같습니다. 결국은 사용자의 환경은 Android 11로 넘어 갈 것이고 <code class="highlighter-rouge">Scoped Storage</code>대응을 미루어야 할 이유는 없습니다.</p>
  <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span> 
                     <span class="na">android:maxSdkVersion=</span><span class="s">"28"</span> <span class="nt">/&gt;</span>
</code></pre></div>  </div>
</blockquote>

<p>매번 이야기 하기가 번거롭기 때문에 용어를 정리하겠습니다. <code class="highlighter-rouge">Scoped Storage 적용된 상태</code>라는 말은 targetSdkVersion 29에서 requestLegacyExternalStorage를 사용하지 않았거나 targetSdkVersion 30을 적용한 앱을 Android 10 단말에서 사용하는 상태를 말합니다.</p>

<h3 id="파일-생성과-쓰기-방법이-변경-되었습니다">파일 생성과 쓰기 방법이 변경 되었습니다.</h3>

<p>예를 들어 아래처럼 메모리카드 루트폴더에 폴더를 생성하고 파일쓰기가 가능했지만, 이제 WRITE_EXTERNAL_STORAGE가 허용되지 않으니 Scoped Storage가 적용 된 상태라면 아래의 코드는 파일을 생성 할 수 없습니다. 아마도 <code class="highlighter-rouge">open failed: ENOENT (No such file or directory)</code> 같은 에러가 발생할 것 입니다.</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">Environment</span><span class="p">.</span><span class="n">getExternalStorageDirectory</span><span class="p">().</span><span class="n">getAbsolutePath</span><span class="p">()+</span><span class="s">"/tmp"</span>
        <span class="o">....</span>
<span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span> <span class="c1">// case #1
</span>        
</code></pre></div></div>
<p>대신 앱 영역(apps’ private directories)에 파일을 생성하는데 제한은 없습니다.</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getDir</span><span class="p">(</span><span class="s">"tmp"</span><span class="p">,</span> <span class="n">Context</span><span class="p">.</span><span class="n">MODE_PRIVATE</span><span class="p">).</span><span class="n">getPath</span><span class="p">()</span>
        <span class="o">....</span>
<span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span> <span class="c1">// case #2
</span>        
</code></pre></div></div>

<p><code class="highlighter-rouge">Scoped Storage 적용되지 않은 상태</code>에서는 새롭게 생성한 이미지나 미디어 파일을 컨텐츠 프로바이더를 이용하여 갤러리에 노출하기 위해서는 아래처럼 contentResolver에 파일을 등록하도록 하였습니다. 코드의 문맥을 보면 파일의 절대경로는 별도로 존재하고 DB에 해당 파일의 row를 추가하는 형태 였습니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">val</span> <span class="n">contentValues</span> <span class="o">=</span> <span class="n">ContentValues</span><span class="o">()</span>
        <span class="o">....</span>
<span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">DATA</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">absolutePath</span><span class="o">)</span> 
<span class="n">contentResolver</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">EXTERNAL_CONTENT_URI</span><span class="o">,</span> <span class="n">contentValues</span><span class="o">)</span> <span class="c1">// case #3  </span>
</code></pre></div></div>
<p><code class="highlighter-rouge">Scoped Storage 적용된 상태</code>에서 case #2의 형태로 생성한 파일생성하고, case #3의 코드로 미디어를 등록하면 되지않을까하고 한번 해보았지만 역시나 동작하지않았습니다. 갤러리앱에 썸네일이 추가되어 추가적인 커맨드를 수행하면 되지 않을까 했지만, 단순히 DB에 row가 추가 되었고 실제 파일에 연결되진 않았습니다. 권한에의해 링크가 깨진 상태라고 생각 하면 될 것 같네요. 리눅스의 파일권한을 생각하시면 될 것 같습니다.</p>

<p><img src="assets/images/post/2021-02-01-android-11-R/capture_failure_02.png" alt="capture2" /></p>

<p><code class="highlighter-rouge">Scoped Storage 적용된 상태</code>에서 <code class="highlighter-rouge">MediaStore</code>를 이용하여 이미지,비디오,오디오,다운로된 파일의 경로에 추가 하기 위해서는 아래의 코드 처럼 작성해야 합니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ContentValues</span> <span class="n">contentValues</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentValues</span><span class="o">()</span>
<span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">IS_PENDING</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>   <span class="c1">// I/O는 오래 걸리니... 일단 PENDING 시켜놓고</span>
<span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">RELATIVE_PATH</span><span class="o">,</span> <span class="n">Environment</span><span class="o">.</span><span class="na">DIRECTORY_PICTURES</span><span class="o">)</span> <span class="c1">// 경로를 결정합니다.</span>
        <span class="o">....</span>
<span class="n">val</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">getContentResolver</span><span class="o">().</span><span class="na">insert</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">EXTERNAL_CONTENT_URI</span><span class="o">,</span> <span class="n">contentValues</span><span class="o">)</span>
<span class="n">getContentResolver</span><span class="o">().</span><span class="na">openFileDescriptor</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="s">"w"</span><span class="o">).</span><span class="na">use</span> <span class="o">{</span>    <span class="c1">// 앞서 얻은 uri와 ContentResolver를 이용해서 접근하도록 합시다.</span>
    <span class="n">val</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">it</span><span class="o">!!.</span><span class="na">getFileDescriptor</span><span class="o">())</span>
    <span class="o">...</span>
    <span class="n">outputStream</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">contentValues</span><span class="o">.</span><span class="na">clear</span><span class="o">()</span>
<span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">SIZE</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">length</span><span class="o">())</span>
<span class="n">contentValues</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">IS_PENDING</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>    <span class="c1">// 작업이 끝나면 PENDING을 해제합니다.</span>
<span class="n">getContentResolver</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">fileUri</span><span class="o">,</span> <span class="n">contentValues</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
</code></pre></div></div>
<p>애초에 파일 생성을 <code class="highlighter-rouge">getContentResolver().insert({Columns}.EXTERNAL_CONTENT_URI, contentValues)</code>로 생성해야합니다. 파일을 생성하면 바로 콘텐츠 프로바이더에서 접근 가능하기 때문에 IO를 고려하며 <code class="highlighter-rouge">IS_PENDING</code>값을 <code class="highlighter-rouge">1</code>로 우선 insert하고 완료되면 <code class="highlighter-rouge">0</code>으로 업데이트합니다. 컨텐츠가 저장되는 폴더는 {Columns}.RELATIVE_PATH에 값을 적절한 값을 넣어주면 됩니다.</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Columns</th>
      <th>RELATIVE_PATH</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>이미지</td>
      <td>MediaStore.Images.Media</td>
      <td>Environment.DIREC TORY_PICTURES <br />Environment.DIRECTORY_DCIM</td>
    </tr>
    <tr>
      <td>영상</td>
      <td>MediaStore.Video.Media</td>
      <td>Environment.DIRECTORY_MOVIES</td>
    </tr>
    <tr>
      <td>음악</td>
      <td>MediaStore.Audio.Media</td>
      <td>Environment.DIRECTORY_MUSIC</td>
    </tr>
    <tr>
      <td>다운로드</td>
      <td>MediaStore.Downloads</td>
      <td>Environment.DIRECTORY_DOWNLOADS</td>
    </tr>
  </tbody>
</table>

<p><a href="https://developer.android.com/training/data-storage/shared/media?hl=ko#toggle-pending-status">https://developer.android.com/training/data-storage/shared/media?hl=ko#toggle-pending-status</a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// res/raw폴더에 source파일을 추가하고 실행하면 실제로 동작하는 코드입니다. </span>
<span class="n">val</span> <span class="n">audioCollection</span> <span class="o">=</span> <span class="n">MediaStore</span><span class="o">.</span><span class="na">Audio</span><span class="o">.</span><span class="na">Media</span>
        <span class="o">.</span><span class="na">getContentUri</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">VOLUME_EXTERNAL_PRIMARY</span><span class="o">)</span>
<span class="n">val</span> <span class="n">songDetails</span> <span class="o">=</span> <span class="n">ContentValues</span><span class="o">().</span><span class="na">apply</span> <span class="o">{</span>
    <span class="n">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Audio</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">DISPLAY_NAME</span><span class="o">,</span> <span class="s">"My Workout Playlist.mp3"</span><span class="o">)</span>
    <span class="n">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Audio</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">IS_PENDING</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">val</span> <span class="n">songContentUri</span> <span class="o">=</span> <span class="n">contentResolver</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">audioCollection</span><span class="o">,</span> <span class="n">songDetails</span><span class="o">)!!</span>
<span class="n">contentResolver</span><span class="o">.</span><span class="na">openFileDescriptor</span><span class="o">(</span><span class="n">songContentUri</span><span class="o">,</span> <span class="s">"w"</span><span class="o">,</span> <span class="kc">null</span><span class="o">)?.</span><span class="na">use</span> <span class="o">{</span> <span class="n">pfd</span> <span class="o">-&gt;</span>
    <span class="n">val</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="na">openRawResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">raw</span><span class="o">.</span><span class="na">source</span><span class="o">)</span>   
    <span class="n">val</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">pfd</span><span class="o">.</span><span class="na">fileDescriptor</span><span class="o">)</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">val</span> <span class="n">data</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">read</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">break</span>
        <span class="o">}</span>
        <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="n">inputStream</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
    <span class="n">outputStream</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="o">}</span>
<span class="n">songDetails</span><span class="o">.</span><span class="na">clear</span><span class="o">()</span>
<span class="n">songDetails</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Audio</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">IS_PENDING</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">contentResolver</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">songContentUri</span><span class="o">,</span> <span class="n">songDetails</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
</code></pre></div></div>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/mond.jpg" alt="mond" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/mond">jisoo Yang</a></h4>
                                
                                    <p>Android application developer</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/mond">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://mond-al.github.io/android-11-R-Storage';
                            this.page.identifier = '/android-11-R-Storage';
                            this.page.title = '안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://mond-al.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Developer/App/Android/mond > Log &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/android/">Android</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/error-log-android-11-api-changed">java.lang.NoSuchMethodError No virtual method log(ILjava/lang/String;Ljava/lang/Throwable</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/dependency-gradle">앱의 의존성 확인하고 전이 의존성 변경하기</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ProductFlavors-BuildType">ProductFlavors와 BuildType 조합</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/android/">
                                
                                    See all 4 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/error-log-android-11-api-changed">
                <div class="post-card-image" style="background-image: url(/assets/images/cover/common_error_log.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/error-log-android-11-api-changed">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Android</span>
                            
                        
                            
                               <span class="post-card-tags">Error</span>
                            
                        
                            
                                <span class="post-card-tags">Log</span>
                            
                        
                    

                    <h2 class="post-card-title">java.lang.NoSuchMethodError No virtual method log(ILjava/lang/String;Ljava/lang/Throwable</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/mond.jpg" alt="jisoo Yang" />
                        
                        <span class="post-card-author">
                            <a href="/author/mond/">jisoo Yang</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://mond-al.github.io/">
            
            <span>Developer/App/Android/mond > Log</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">안드로이드 targetSdkVersion 30으로 올리기(Scoped Storage)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%EC%95%88%EB%93%9C%EB%A1%9C%EC%9D%B4%EB%93%9C+targetSdkVersion+30%EC%9C%BC%EB%A1%9C+%EC%98%AC%EB%A6%AC%EA%B8%B0%28Scoped+Storage%29&amp;url=https://mond-al.github.io/android-11-R-Storage"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://mond-al.github.io/android-11-R-Storage"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://mond-al.github.io/">Developer/App/Android/mond > Log</a> &copy; 2021</section>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js" integrity="sha512-9GIHU4rPKUMvNOHFOer5Zm2zHnZOjayOO3lZpokhhCtgt8FNlNiW/bb7kl0R5ZXfCDVPcQ8S4oBdNs92p5Nm2w==" crossorigin="anonymous"></script>


    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GGKL7TBGBY"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 gtag('config', 'G-GGKL7TBGBY');
</script>

    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
